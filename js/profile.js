var __awaiter=this&&this.__awaiter||function(o,s,a,d){return new(a||(a=Promise))(function(t,e){function n(t){try{r(d.next(t))}catch(t){e(t)}}function i(t){try{r(d.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(n,i)}r((d=d.apply(o,s||[])).next())})},__generator=this&&this.__generator||function(n,i){function t(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(s=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[0,s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=i.call(n,a)}catch(t){e=[6,t],o=0}finally{r=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}var r,o,s,e,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e},AddPositionSection=function(){function t(){var e=this;this.userId=localStorage.getItem("user"),this.onAddPositionPress=function(){e.getDataFromInputs();var t=new List;t.addItemToList(e.titlePosition,e.desctiptioPosition,e.typePosition,e.coust,e.inputDate),e.clearInputs(),t.createCards()},this.addPositionButton=document.getElementById("add-position").addEventListener("click",this.onAddPositionPress);var t=new TypeCard;t.initializationTypes("type-position"),t.initializationTypes("typeFilterParameter")}return t.prototype.getDataFromInputs=function(){this.titlePosition=document.getElementById("title-position").value,this.desctiptioPosition=document.getElementById("description").value,this.typePosition=document.getElementById("type-position").value,this.inputDate=document.getElementById("date").value,this.coust=document.getElementById("coust").value,this.coust=this.coust.toLocaleString(),this.date=new Date(this.inputDate)},t.prototype.clearInputs=function(){this.titlePosition=document.getElementById("title-position").value="",this.coust=document.getElementById("coust").value="",this.desctiptioPosition=document.getElementById("description").value=""},t}(),List=function(){function t(){var e=this;this.userId=localStorage.getItem("user"),this.deleteCardInDatabase=function(t){firebase.database().ref("users/"+e.userId+"/listPosition/"+t).remove()},this.onFilterPress=function(){e.getParametersFromFilterPanel(),e.clearInputsInFilterSection()},this.onShowAllPress=function(){for(var t=0,e=Array.from(document.getElementsByClassName("wrapCard"));t<e.length;t++){e[t].style.display="flex"}},this.filterButton=document.getElementById("filter-btn").addEventListener("click",this.onFilterPress),this.showAllButton=document.getElementById("show-all").addEventListener("click",this.onShowAllPress);document.getElementById("typeFilterParameter")}return t.prototype.addItemToList=function(t,e,n,i,r){firebase.database().ref("users/"+this.userId+"/listPosition").push({title:t,description:e,type:n,date:r,coust:i})},t.prototype.getItemToList=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,firebase.database().ref("/users/"+this.userId+"/listPosition/").once("value")];case 1:return e=t.sent(),[2,e.val()]}})})},t.prototype.createCards=function(){var n,i,r,o,s,t=this.getItemToList();document.getElementById("cardList").innerHTML=" ",t.then(function(t){for(var e in t){n=t[e].title,i=t[e].description,r=t[e].type,o=t[e].coust,s=t[e].date;new Card(n,i,r,s,o,e)}})},t.prototype.getParametersFromFilterPanel=function(){var t=document.getElementById("dateFilterParameter").value,e=document.getElementById("typeFilterParameter").value;this.filterCardsInListSection(e,t)},t.prototype.clearInputsInFilterSection=function(){var t=document.getElementById("dateFilterParameter");document.getElementById("typeFilterParameter");t.value=""},t.prototype.filterCardsInListSection=function(t,e){for(var n=0,i=Array.from(document.getElementsByClassName("wrapCard"));n<i.length;n++){var r=i[n],o=r.getAttribute("type"),s=r.getAttribute("date");r.style.display=o==t&&s==e?"flex":"none",console.log(s)}},t}(),Card=function(){function t(t,e,n,i,r,o){var s=this;this.divWrap=document.getElementById("cardList"),this.divCard=document.createElement("div"),this.divCardBody=document.createElement("div"),this.cardTitle=document.createElement("h5"),this.cardDescription=document.createElement("p"),this.listGrup=document.createElement("ul"),this.type=document.createElement("li"),this.date=document.createElement("li"),this.coust=document.createElement("li"),this.divCardBody2=document.createElement("div"),this.buttonDelete=document.createElement("button"),this.userId=localStorage.getItem("user"),this.onDeletePressed=function(){var t=new List;s.removeCardFromUI(s.buttonDelete.id),t.deleteCardInDatabase(s.buttonDelete.id)},this.buildCardHTML(),this.cardTitle.innerHTML=t,this.cardDescription.innerHTML=e,this.type.innerHTML="Type: "+n,this.date.innerHTML="Date: "+i,this.coust.innerHTML="Coust: "+r,this.buttonDelete.id=o,this.divCard.id=o,this.divCard.setAttribute("date",i),this.divCard.setAttribute("type",n)}return t.prototype.buildCardHTML=function(){this.divWrap.appendChild(this.divCard),this.divCard.className="card wrapCard",this.divCardBody.className="card-body",this.divCard.appendChild(this.divCardBody),this.divCard.appendChild(this.listGrup),this.listGrup.className="list-group list-group-flush",this.divCard.appendChild(this.divCardBody2),this.cardTitle.className="card-title",this.cardDescription.className="card-text",this.divCardBody.appendChild(this.cardTitle),this.divCardBody.appendChild(this.cardDescription),this.listGrup.appendChild(this.type),this.listGrup.appendChild(this.date),this.listGrup.appendChild(this.coust),this.type.className="list-group-item",this.date.className="list-group-item",this.coust.className="list-group-item",this.divCardBody2.className="card-body card-button-wrap",this.divCardBody2.appendChild(this.buttonDelete),this.buttonDelete.className="btn btn-link delete",this.buttonDelete.type="button",this.buttonDelete.innerHTML="Delete",this.buttonDelete.addEventListener("click",this.onDeletePressed)},t.prototype.removeCardFromUI=function(t){document.getElementById(t).remove()},t}(),LeftSideBad=function(){this.singOutButton=document.getElementById("singOut"),this.singOut=function(){firebase.auth().signOut().then(function(){window.location.href="./index.html"}).catch(function(t){console.log(t)})},this.singOutButton.addEventListener("click",this.singOut)},Profile=function(){function t(){var e=this;this.newTypeButton=document.getElementById("btn-new-type"),this.newTypeInput=document.getElementById("new-type-input"),this.newPasswordButton=document.getElementById("newPassword-btn"),this.newPasswordInput=document.getElementById("newPassword"),this.type=new TypeCard,this.onPtessNewTypeButton=function(){var t;t=e.newTypeInput.value,e.type.addTypeToDatabase(t),e.reloadType(),e.newTypeInput.value=" "},this.onPtessNewPasswordButton=function(){e.getEmail().then(function(t){console.log(t.email),e.updatePassword(t.email)})},this.newTypeButton.addEventListener("click",this.onPtessNewTypeButton),this.newPasswordButton.addEventListener("click",this.onPtessNewPasswordButton)}return t.prototype.getEmail=function(){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(t){switch(t.label){case 0:return e=localStorage.getItem("user"),[4,firebase.database().ref("/users/"+e).once("value")];case 1:return n=t.sent(),[2,n.val()]}})})},t.prototype.updatePassword=function(t){firebase.auth().sendPasswordResetEmail(t).then(function(){alert("Email sent")}).catch(function(t){alert("An error happened")})},t.prototype.reloadType=function(){document.getElementById("type-position").innerHTML="",document.getElementById("typeFilterParameter").innerHTML="",this.type.initializationTypes("type-position"),this.type.initializationTypes("typeFilterParameter")},t}(),TypeCard=function(){function t(){}return t.prototype.addTypeToDatabase=function(t){var e=localStorage.getItem("user");firebase.database().ref("users/"+e+"/Types").push({type:t})},t.prototype.getType=function(){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(t){switch(t.label){case 0:return e=localStorage.getItem("user"),[4,firebase.database().ref("/users/"+e+"/Types/").once("value")];case 1:return n=t.sent(),[2,n.val()]}})})},t.prototype.initializationTypes=function(n){var i=this;this.getType().then(function(t){for(var e in t)i.buildHTML(t[e].type,n)})},t.prototype.buildHTML=function(t,e){var n=document.getElementById(e),i=document.createElement("option");n.appendChild(i),i.value=t,i.innerHTML=t},t}(),Charts=function(){function t(){}return t.prototype.getCards=function(){return __awaiter(this,void 0,void 0,function(){var e,n,i;return __generator(this,function(t){switch(t.label){case 0:return n=new List,e=n.getItemToList(),i=[],[4,e.then(function(t){for(var e in t){new Date(t[e].date).toDateString();i.push({coust:t[e].coust,type:t[e].type})}})];case 1:return t.sent(),[2,i]}})})},t.prototype.createChartsLisT=function(){return __awaiter(this,void 0,void 0,function(){var e,n,i,r,o,s;return __generator(this,function(t){switch(t.label){case 0:return[4,this.getCards()];case 1:for(r in e=t.sent(),n=new Map,i=[],e)n.has(e[r].type)?(o=parseFloat(n.get(e[r].type)),s=o+parseFloat(e[r].coust),n.set(e[r].type,s)):n.set(e[r].type,e[r].coust);return n.forEach(function(t,e){Math.floor(16777215*Math.random()).toString(16);i.push({type:e,cousr:parseInt(t)})}),localStorage.setItem("charts",JSON.stringify(i)),[2]}})})},t}();window.onload=function(){new AddPositionSection,new LeftSideBad,new Profile,(new Charts).createChartsLisT(),(new List).createCards()};